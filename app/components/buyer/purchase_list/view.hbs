{{#component "pur-list trade-manage js-comp clearfix"}}
  <div class="buyer-pur-lists" data-pur-lists-total="{{_DATA_.total}}"></div>
  <input type="hidden" class="js-purchase-tag" value="{{tag}}">
  <div class="page-body-option clearfix">
    <div class="page-title">预购单列表</div>
  </div>
  <div class="pur-list-body">
    <div class="page-list-search clearfix">
      <div class="search-table">
        <div class="search-row">
          <span class="search-label"><label>下单时间：</label></span>
          <span class="search-cell">
            <span class="time-interval-input create-time"></span>
          </span>
          <span class="search-label"><label>状态：</label></span>
          <span class="search-cell">
            <select class="js-select-status select">
              <option value="">全部状态</option>
              <option value="0" {{#equals status 0}}selected{{/equals}}>草稿</option>
              <option value="1" {{#equals status 1}}selected{{/equals}}>部门审核中</option>
              <option value="2" {{#equals status 2}}selected{{/equals}}>财务审核中</option>
              <option value="3" {{#equals status 3}}selected{{/equals}}>单位审批中</option>
              <option value="4" {{#equals status 4}}selected{{/equals}}>已驳回</option>
              <option value="5" {{#equals status 5}}selected{{/equals}}>审核通过</option>
              <option value="10" {{#equals status 10}}selected{{/equals}}>已产生订单</option>
              <option value="-3" {{#equals status -3}}selected{{/equals}}>已撤消</option>
            </select>
          </span>
          <span class="search-label"><label>商品名称：</label></span>
          <span class="search-cell">
            <input name="itemName" type="text" placeholder='请输入商品名称' value="{{itemName}}">
          </span>
        </div>
        <div class="search-row">
          <span class="search-label"><label>预购单金额(元)：</label></span>
          <span class="search-cell">
            <input class="js-search-minFee money-input"
                   name="minFee" type="text" placeholder='请输入最小价格'
                   value="{{minFee}}"> -
            <input class="js-search-maxFee money-input"
                   name="maxFee" type="text" placeholder='请输入最大价格'
                   value="{{maxFee}}">
          </span>
          <span class="search-label"><label>预购单号：</label></span>
          <span class="search-cell">
            <input name="pno" type="text" placeholder='请输入（支持后6位搜索）' value="{{pno}}">
          </span>
          <span class="search-label"><label>供应商名称：</label></span>
          <span class="search-cell">
            <select name="supplierOrg" class="noselectric" data-org-name="{{supplierOrgName}}" data-org-id="{{supplierOrgId}}"></select>
          </span>
        </div>
        <div class="search-row">
          <span class="search-label"><label>采购计划文号：</label></span>
          <span class="search-cell">
            <input name="confirmationNo" type="text" placeholder='请输入（支持模糊搜索）' value="{{confirmationNo}}" style="margin-right: 92px;">
          </span>
          <span class="search-label"><label>采购经办人：</label></span>
          <span class="search-cell">
            <select name="purchaser" class="noselectric" data-name="{{purchaserName}}" data-user-id="{{purchaserId}}"></select>
          </span>
          {{!疫苗采购单位支持搜索下级采购单位}}
          {{#equals _ELEMENT_.purchaserList true}}
            <span class="search-label"><label>采购单位：</label></span>
            <span class="search-cell">
              <select class="noselectric" data-org-name="{{purchaseOrgName}}" data-org-id="{{orgId}}" name="purchaseOrg"></select>
            </span>
          {{/equals}}
        </div>
      </div>
      <div class="operation-row">
        <div class="search-button">
          <a class="btn btn-info js-search">搜索</a>
          <a class="btn btn-info js-search-reset">重置</a>
        </div>
      </div>
    </div>
    <table class="table  center-tex pur-list-table">
      <thead>
      <tr>
        <th width="15%">预购单号</th>
        <th width="15%">预购单金额(元)</th>
        <th width="15%">最后操作时间</th>
        <th width="15%">状态</th>
        <th width="15%">预购单类型</th>
        <th width="15%">当前责任人</th>
        <th width="10%">操作</th>
      </tr>
      </thead>
      <tbody>
      {{#if _DATA_.data}}
        {{#each _DATA_.data}}
          <tr data-purchase="{{id}}" class="purchase-tr">
            <td><a
              href="/buyer/purchases/detail?purchaseId={{id}}&businessId={{id}}&tableCode=zcy_purchase_orders">{{id}}</a>
            </td>
            <td>
              {{#equals type 3}}
                <span class="text-center">-</span>
              {{else}}
                <span class="price">{{_CURRENCY_}}<span class="purchase-subtotal">{{formatPrice totalFee}}</span></span>
              {{/equals}}
            </td>
            <td>
              <span class="purchase-span"><span class="">{{formatDate updatedAt}}</span></span>
            </td>
            <td>
              {{#equals status -1}}已取消{{/equals}}
              {{#equals status 0}}草稿{{/equals}}
              {{#equals status 1}}部门审核中{{/equals}}
              {{#equals status 2}}财务审核中{{/equals}}
              {{#equals status 3}}单位审批中{{/equals}}
              {{#equals status 4}}已驳回{{/equals}}
              {{#equals status 5}}审核通过{{/equals}}
              {{#equals status 10}}已产生订单{{/equals}}
              {{#equals status -3}}已撤销{{/equals}}
            </td>
            <td>
              {{#equals type 0}}网超预购单{{/equals}}
              {{#equals type 2}}疫苗预购单{{/equals}}
              {{#equals type 3}}大宗预购单{{/equals}}
            </td>
            <td data-current-operator-id="{{currentOperatorId}}"><a class="js-get-phone"
                                                                    data-user-id="{{currentOperatorId}}"
                                                                    data-user-type="1">{{currentOperatorName}}</a></td>
            <td>
              {{#of "1" _ROLES_}}
                {{#of status "0,4,-3"}}{{#equals _USER_.id purchaserId}}
                  <a href="/buyer/purchase-process?purchaseId={{id}}"
                     class="purchase-name">处理预购单</a><br>{{/equals}}{{/of}}
                {{#equals status 5}}
                  {{#equals _USER_.id currentOperatorId}}
                    <a href="/buyer/confirmOrder?purchaseId={{id}}">确定订单</a><br>
                  {{/equals}}
                {{/equals}}
                {{#of status "0,-1,-3"}}{{#equals _USER_.id purchaserId}}
                  <a class="js-pur-delete">删除</a><br>{{/equals}}{{/of}}
              {{/of}}
              {{#of "2" _ROLES_}}
                {{#equals status 1}}{{#equals _USER_.id currentOperatorId}}
                  <a href="/buyer/purchase-check?purchaseId={{id}}">部门审核</a><br>{{/equals}}{{/equals}}
              {{/of}}
              {{#of "3" _ROLES_}}
                {{#equals status 2}}{{#equals _USER_.id currentOperatorId}}
                  <a href="/buyer/purchase-check?purchaseId={{id}}">财务审核</a><br>{{/equals}}{{/equals}}
              {{/of}}
              {{#of "4" _ROLES_}}
                {{#equals status 3}}{{#equals _USER_.id currentOperatorId}}
                  <a href="/buyer/purchase-check?purchaseId={{id}}">单位审核</a><br>{{/equals}}{{/equals}}
              {{/of}}
              {{#of status "1,2,3,5"}} {{#equals _USER_.id purchaserId}}
                <a href="javascript:void(0)" class="reversed" data-toggle="modal"
                   data-target="#reversedModal">撤销</a>{{/equals}}{{/of}}
              <a href="/buyer/purchases/detail?purchaseId={{id}}&businessId={{id}}&tableCode=zcy_purchase_orders"
                 class="purchase-name">查看详情</a>
            </td>
          </tr>
          {{#each items}}
            <tr class="item-tr" data-site="{{../id}}" data-id="{{skuId}}">
              <td width="24" class="check">
              </td>
              <td class="left-text">
                <div class="pur-list">
                  <div class="item-description">
                    <span><a href="/items/{{itemId}}">{{itemName}}</a></span>
                    <span>{{itemName}}</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sku-attrs">{{#each skuAttr}}{{@key}}
                    :{{this}}&nbsp;&nbsp;{{/each}}</span>
                  </div>
                </div>
              </td>
              <td>
                <span class="sku-price">{{formatPrice price}}</span>
                <span class="count-number">{{currentCount}}</span>
                <span class="item-subtotal"></span>
              </td>
              <td></td>
              <td></td>
            </tr>
          {{/each}}
        {{/each}}
      {{else}}
        <tr>
          <td colspan="7" class="text-center">没有相关数据</td>
        </tr>
      {{/if}}
      </tbody>
    </table>
    <div class="list-pagination pagination-danger clearfix"
         data-size="{{#if pageSize ~}}{{pageSize}}{{else}}20{{~/if}}"
         data-total="{{_DATA_.total}}"></div>
  </div>
  <div id="reversedModal" class="modal" style="display:none;">
    <div>
      <div class="modal-header">
        <span style="font-size:14px;">取消预购单</span>
      </div>
      <div class="modal-body" style="">
        <div>
          <div style="margin-bottom:20px;"><label class="required">*</label>取消理由：</div>
          <textarea name="reverseModalRemark" id="" cols="30" rows="10" style="width:400px;height:100px;"
                    placeholder="请输入取消理由" required></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn  btn-primary btn-medium" id="reversedConfirm">确定</button>
        &nbsp;&nbsp;
        <button class="btn btn-secondary btn-medium close">取消</button>

      </div>
    </div>
  </div>
{{/component}}
